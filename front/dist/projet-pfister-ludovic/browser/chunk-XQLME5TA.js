import{a as J}from"./chunk-62AXM7PA.js";import{a as L,b as d,c as q,d as V,g as z,h as R,i as A,j as $,k as j,l as G,m as B,o as H,q as Y}from"./chunk-NPZKDYSZ.js";import{a as N,b as U}from"./chunk-BPMLG3PT.js";import{j as T,k as x,m as P}from"./chunk-SDRDLNE6.js";import{$a as p,Aa as r,Ja as y,Oa as h,Q as S,Ta as m,U as I,aa as F,ab as o,ba as O,bb as t,cb as c,ga as _,hb as M,ib as f,jb as s,nb as g,ob as k,pb as l,qb as v,rb as u,sb as D,ya as w}from"./chunk-4TET6FDT.js";function Z(i,n){if(i&1&&(o(0,"div",9)(1,"span",6),l(2,"Photo :"),t(),o(3,"div",13),c(4,"img",14),t()()),i&2){let e=s();r(4),p("src",e.pollution.photoUrl,w)("alt",e.pollution.titre)}}var C=class i{pollution;reset=new _;formatDate(n){return new Date(n).toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric"})}onReset(){this.reset.emit()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=h({type:i,selectors:[["app-pollution-recap"]],inputs:{pollution:"pollution"},outputs:{reset:"reset"},decls:43,vars:10,consts:[[1,"recap-container"],[1,"recap-header"],[1,"success-message"],[1,"recap-content"],[1,"recap-grid"],[1,"recap-item"],[1,"label"],[1,"value"],[1,"value","badge"],[1,"recap-item","full-width"],[1,"description"],["class","recap-item full-width",4,"ngIf"],[1,"btn-reset",3,"click"],[1,"photo-container"],[3,"src","alt"]],template:function(e,a){e&1&&(o(0,"div",0)(1,"div",1)(2,"h2"),l(3,"D\xE9claration enregistr\xE9e"),t(),o(4,"p",2),l(5,"Merci pour votre contribution \xE0 la protection de l'environnement !"),t()(),o(6,"div",3)(7,"h3"),l(8,"R\xE9capitulatif de votre d\xE9claration"),t(),o(9,"div",4)(10,"div",5)(11,"span",6),l(12,"Titre :"),t(),o(13,"span",7),l(14),t()(),o(15,"div",5)(16,"span",6),l(17,"Type de pollution :"),t(),o(18,"span",8),l(19),t()(),o(20,"div",5)(21,"span",6),l(22,"Date d'observation :"),t(),o(23,"span",7),l(24),t()(),o(25,"div",5)(26,"span",6),l(27,"Lieu :"),t(),o(28,"span",7),l(29),t()(),o(30,"div",5)(31,"span",6),l(32,"Coordonn\xE9es GPS :"),t(),o(33,"span",7),l(34),t()(),o(35,"div",9)(36,"span",6),l(37,"Description :"),t(),o(38,"p",10),l(39),t()(),m(40,Z,5,2,"div",11),t(),o(41,"button",12),f("click",function(){return a.onReset()}),l(42," Faire une nouvelle d\xE9claration "),t()()()),e&2&&(r(14),v(a.pollution.titre),r(4),k("badge-"+a.pollution.type.toLowerCase().replace(" ","-")),r(),u(" ",a.pollution.type," "),r(5),v(a.formatDate(a.pollution.dateObservation)),r(5),v(a.pollution.lieu),r(5),D(" ",a.pollution.latitude,", ",a.pollution.longitude," "),r(5),v(a.pollution.description),r(),p("ngIf",a.pollution.photoUrl))},dependencies:[P,x],styles:[".recap-container[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:8px;box-shadow:0 2px 8px #0000001a}.recap-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:2rem;padding-bottom:1rem;border-bottom:2px solid #4CAF50}.recap-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#4caf50;margin-bottom:.5rem}.success-message[_ngcontent-%COMP%]{color:#666;font-size:1rem}.recap-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:1.5rem;color:#333}.recap-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;margin-bottom:2rem}.recap-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.recap-item.full-width[_ngcontent-%COMP%]{grid-column:1 / -1}.label[_ngcontent-%COMP%]{font-weight:600;color:#555;font-size:.9rem}.value[_ngcontent-%COMP%]{color:#333;font-size:1rem}.description[_ngcontent-%COMP%]{color:#333;line-height:1.6;white-space:pre-wrap;background:#f9f9f9;padding:1rem;border-radius:4px;margin:0}.badge[_ngcontent-%COMP%]{display:inline-block;padding:.4rem .8rem;border-radius:20px;font-size:.875rem;font-weight:600;text-align:center}.badge-plastique[_ngcontent-%COMP%]{background:#ffe5b4;color:#8b4513}.badge-chimique[_ngcontent-%COMP%]{background:#ffe4e1;color:#dc143c}.badge-d\\e9p\\f4t-sauvage[_ngcontent-%COMP%]{background:#e6e6fa;color:indigo}.badge-eau[_ngcontent-%COMP%]{background:#e0f2f7;color:#0277bd}.badge-air[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32}.badge-autre[_ngcontent-%COMP%]{background:#f5f5f5;color:#616161}.photo-container[_ngcontent-%COMP%]{margin-top:.5rem;border-radius:8px;overflow:hidden;max-width:100%}.photo-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:auto;display:block;max-height:400px;object-fit:cover}.btn-reset[_ngcontent-%COMP%]{width:100%;padding:1rem;background:#2196f3;color:#fff;border:none;border-radius:4px;font-size:1rem;font-weight:600;cursor:pointer;transition:background .3s}.btn-reset[_ngcontent-%COMP%]:hover{background:#1976d2}@media(max-width:768px){.recap-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.recap-container[_ngcontent-%COMP%]{padding:1rem}}"]})};var E=class i{constructor(n){this.http=n}apiUrl="http://localhost:3000/api/pollutions";getAllPollutions(){return this.http.get(this.apiUrl)}getPollutionById(n){return this.http.get(`${this.apiUrl}/${n}`)}createPollution(n){return this.http.post(this.apiUrl,n)}createPollutions(n){return this.http.post(this.apiUrl,n)}updatePollution(n,e){return this.http.put(`${this.apiUrl}/${n}`,e)}deletePollution(n){return this.http.delete(`${this.apiUrl}/${n}`)}searchPollutions(n){let e=new N;return n.type&&(e=e.set("type",n.type)),n.titre&&(e=e.set("titre",n.titre)),n.lieu&&(e=e.set("lieu",n.lieu)),this.http.get(this.apiUrl,{params:e})}static \u0275fac=function(e){return new(e||i)(I(U))};static \u0275prov=S({token:i,factory:i.\u0275fac,providedIn:"root"})};function te(i,n){if(i&1&&(o(0,"span",27),l(1),t()),i&2){let e=s(2);r(),u(" ",e.getErrorMessage("titre")," ")}}function ne(i,n){if(i&1&&(o(0,"option",28),l(1),t()),i&2){let e=n.$implicit;p("value",e),r(),u(" ",e," ")}}function ie(i,n){if(i&1&&(o(0,"span",27),l(1),t()),i&2){let e=s(2);r(),u(" ",e.getErrorMessage("type")," ")}}function oe(i,n){if(i&1&&(o(0,"span",27),l(1),t()),i&2){let e=s(2);r(),u(" ",e.getErrorMessage("description")," ")}}function re(i,n){if(i&1&&(o(0,"span",27),l(1),t()),i&2){let e=s(2);r(),u(" ",e.getErrorMessage("dateObservation")," ")}}function le(i,n){if(i&1&&(o(0,"span",27),l(1),t()),i&2){let e=s(2);r(),u(" ",e.getErrorMessage("lieu")," ")}}function ae(i,n){if(i&1&&(o(0,"span",27),l(1),t()),i&2){let e=s(2);r(),u(" ",e.getErrorMessage("latitude")," ")}}function pe(i,n){if(i&1&&(o(0,"span",27),l(1),t()),i&2){let e=s(2);r(),u(" ",e.getErrorMessage("longitude")," ")}}function se(i,n){if(i&1){let e=M();o(0,"div",3)(1,"h2"),l(2,"D\xE9clarer une pollution"),t(),o(3,"form",4),f("ngSubmit",function(){F(e);let b=s();return O(b.onSubmit())}),o(4,"div",5)(5,"label",6),l(6,"Titre de la pollution *"),t(),c(7,"input",7),m(8,te,2,1,"span",8),t(),o(9,"div",5)(10,"label",9),l(11,"Type de pollution *"),t(),o(12,"select",10)(13,"option",11),l(14,"-- S\xE9lectionnez un type --"),t(),m(15,ne,2,2,"option",12),t(),m(16,ie,2,1,"span",8),t(),o(17,"div",5)(18,"label",13),l(19,"Description *"),t(),c(20,"textarea",14),m(21,oe,2,1,"span",8),t(),o(22,"div",5)(23,"label",15),l(24,"Date de l'observation *"),t(),c(25,"input",16),m(26,re,2,1,"span",8),t(),o(27,"div",5)(28,"label",17),l(29,"Lieu *"),t(),c(30,"input",18),m(31,le,2,1,"span",8),t(),o(32,"div",19)(33,"div",5)(34,"label",20),l(35,"Latitude *"),t(),c(36,"input",21),m(37,ae,2,1,"span",8),t(),o(38,"div",5)(39,"label",22),l(40,"Longitude *"),t(),c(41,"input",23),m(42,pe,2,1,"span",8),t()(),o(43,"div",5)(44,"label",24),l(45,"URL de la photo (optionnel)"),t(),c(46,"input",25),t(),o(47,"button",26),l(48," D\xE9clarer "),t()()()}if(i&2){let e=s();r(3),p("formGroup",e.pollutionForm),r(4),g("error",e.isFieldInvalid("titre")),r(),p("ngIf",e.isFieldInvalid("titre")),r(4),g("error",e.isFieldInvalid("type")),r(3),p("ngForOf",e.pollutionTypes),r(),p("ngIf",e.isFieldInvalid("type")),r(4),g("error",e.isFieldInvalid("description")),r(),p("ngIf",e.isFieldInvalid("description")),r(4),g("error",e.isFieldInvalid("dateObservation")),r(),p("ngIf",e.isFieldInvalid("dateObservation")),r(4),g("error",e.isFieldInvalid("lieu")),r(),p("ngIf",e.isFieldInvalid("lieu")),r(5),g("error",e.isFieldInvalid("latitude")),r(),p("ngIf",e.isFieldInvalid("latitude")),r(4),g("error",e.isFieldInvalid("longitude")),r(),p("ngIf",e.isFieldInvalid("longitude")),r(5),p("disabled",e.pollutionForm.invalid)}}function de(i,n){if(i&1){let e=M();o(0,"app-pollution-recap",29),f("reset",function(){F(e);let b=s();return O(b.resetForm())}),t()}if(i&2){let e=s();p("pollution",e.submittedData)}}var Q=class i{constructor(n,e){this.fb=n;this.pollutionService=e;this.pollutionForm=this.fb.group({titre:["",[d.required,d.minLength(3)]],type:["",d.required],description:["",[d.required,d.minLength(10)]],dateObservation:["",d.required],lieu:["",[d.required,d.minLength(3)]],latitude:["",[d.required,d.pattern(/^-?([0-9]{1,2}|1[0-7][0-9]|180)(\.[0-9]+)?$/)]],longitude:["",[d.required,d.pattern(/^-?([0-9]{1,2}|1[0-7][0-9]|180)(\.[0-9]+)?$/)]],photoUrl:[""]})}pollutionForm;pollutionTypes=J;showForm=!0;submittedData=null;message="";loading=!1;pollutionAdded=new _;onSubmit(){if(!this.pollutionForm.valid){Object.keys(this.pollutionForm.controls).forEach(e=>{this.pollutionForm.get(e)?.markAsTouched()});return}this.loading=!0,this.message="";let n={titre:this.pollutionForm.value.titre,type_pollution:this.pollutionForm.value.type,description:this.pollutionForm.value.description,date_observation:this.pollutionForm.value.dateObservation,lieu:this.pollutionForm.value.lieu,latitude:parseFloat(this.pollutionForm.value.latitude),longitude:parseFloat(this.pollutionForm.value.longitude),photo_url:this.pollutionForm.value.photoUrl};this.pollutionService.createPollutions(n).subscribe({next:e=>{this.loading=!1,this.submittedData=e,this.message="Pollution enregistr\xE9e avec succ\xE8s \u2705",this.showForm=!1,this.pollutionAdded.emit(e)},error:e=>{this.loading=!1,e.status===401?this.message="Vous devez \xEAtre connect\xE9 pour ajouter une pollution \u274C":this.message="Erreur lors de l\u2019enregistrement \u274C"}})}resetForm(){this.pollutionForm.reset(),this.submittedData=null,this.showForm=!0,this.message=""}isFieldInvalid(n){let e=this.pollutionForm.get(n);return!!(e&&e.invalid&&(e.dirty||e.touched))}getErrorMessage(n){let e=this.pollutionForm.get(n);return e?.hasError("required")?"Ce champ est requis":e?.hasError("minlength")?`Minimum ${e.errors?.minlength.requiredLength} caract\xE8res`:e?.hasError("pattern")&&(n==="latitude"||n==="longitude")?"Coordonn\xE9e invalide (entre -180 et 180)":""}static \u0275fac=function(e){return new(e||i)(y(H),y(E))};static \u0275cmp=h({type:i,selectors:[["app-pollution-form"]],outputs:{pollutionAdded:"pollutionAdded"},decls:3,vars:2,consts:[[1,"form-container"],["class","form-wrapper",4,"ngIf"],[3,"pollution","reset",4,"ngIf"],[1,"form-wrapper"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","titre"],["type","text","id","titre","formControlName","titre","placeholder","Ex: D\xE9p\xF4t de d\xE9chets plastiques"],["class","error-message",4,"ngIf"],["for","type"],["id","type","formControlName","type"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","description"],["id","description","formControlName","description","rows","4","placeholder","D\xE9crivez la pollution observ\xE9e..."],["for","dateObservation"],["type","date","id","dateObservation","formControlName","dateObservation"],["for","lieu"],["type","text","id","lieu","formControlName","lieu","placeholder","Ex: Parc des Vosges, Strasbourg"],[1,"coordinates-group"],["for","latitude"],["type","number","id","latitude","formControlName","latitude","step","0.000001","placeholder","Ex: 48.5734"],["for","longitude"],["type","number","id","longitude","formControlName","longitude","step","0.000001","placeholder","Ex: 7.7521"],["for","photoUrl"],["type","url","id","photoUrl","formControlName","photoUrl","placeholder","https://exemple.com/image.jpg"],["type","submit",1,"btn-submit",3,"disabled"],[1,"error-message"],[3,"value"],[3,"reset","pollution"]],template:function(e,a){e&1&&(o(0,"div",0),m(1,se,49,24,"div",1)(2,de,1,1,"app-pollution-recap",2),t()),e&2&&(r(),p("ngIf",a.showForm),r(),p("ngIf",!a.showForm&&a.submittedData))},dependencies:[P,T,x,Y,z,G,B,L,R,j,q,V,$,A,C],styles:[".form-container[_ngcontent-%COMP%]{max-width:800px;margin:2rem auto;padding:0 1rem}.form-wrapper[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:8px;box-shadow:0 2px 8px #0000001a}h2[_ngcontent-%COMP%]{margin-bottom:1.5rem;color:#333}.form-group[_ngcontent-%COMP%]{margin-bottom:1.5rem}label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-weight:600;color:#555}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:100%;padding:.75rem;border:2px solid #ddd;border-radius:4px;font-size:1rem;transition:border-color .3s}input[_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%]:focus, textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#4caf50}input.error[_ngcontent-%COMP%], select.error[_ngcontent-%COMP%], textarea.error[_ngcontent-%COMP%]{border-color:#f44336}.error-message[_ngcontent-%COMP%]{display:block;color:#f44336;font-size:.875rem;margin-top:.25rem}.coordinates-group[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1rem}.btn-submit[_ngcontent-%COMP%]{width:100%;padding:1rem;background:#4caf50;color:#fff;border:none;border-radius:4px;font-size:1rem;font-weight:600;cursor:pointer;transition:background .3s}.btn-submit[_ngcontent-%COMP%]:hover:not(:disabled){background:#45a049}.btn-submit[_ngcontent-%COMP%]:disabled{background:#ccc;cursor:not-allowed}@media(max-width:768px){.coordinates-group[_ngcontent-%COMP%]{grid-template-columns:1fr}.form-wrapper[_ngcontent-%COMP%]{padding:1rem}}"]})};export{Q as PollutionFormComponent};
