import{a as W,b as M,c as xe,d as Ce,e as Ie,f as Pe,g as ke,h as B,i as h,j as Te,k as w,l as be,m as L,n as Ae,o as Ne,p as R,q as H}from"./chunk-A2WCNDTO.js";import{a as De}from"./chunk-G4BXO6V3.js";import{a as ve,c as _e,d as D,e as ye,f as Ee,g as Me,h as Oe}from"./chunk-QBIJVOJ4.js";import{c as he,d as Se}from"./chunk-BPMLG3PT.js";import{a as we}from"./chunk-OFI7W5LO.js";import{k as fe,l as ue,m as ge}from"./chunk-SDRDLNE6.js";import{$a as b,Aa as y,Ja as E,M as P,Oa as k,Pa as ce,Q as _,R as oe,T as v,Ta as T,U as ne,V as c,Y as ie,a as I,aa as re,ab as l,b as te,ba as ae,bb as m,c as u,ca as se,cb as pe,d as U,fb as $,gb as z,hb as le,ib as me,jb as V,pb as r,qb as de,yb as A,zb as N}from"./chunk-4TET6FDT.js";var X="@@STATE",O=(function(e){return e[e.LocalStorage=0]="LocalStorage",e[e.SessionStorage=1]="SessionStorage",e})(O||{}),G=new v(""),Le=new v("",{providedIn:"root",factory:()=>c(G).keys==="*"}),x=new v(""),Y=new v("");function J(e){return!!e?.engine}function Re(e){return J(e)&&(e=e.key),M(e,W)&&(e=e[W].name),e instanceof xe?e.getName():e}function Ve(e){return te(I({storage:O.LocalStorage,serialize:JSON.stringify,deserialize:JSON.parse,beforeSerialize:o=>o,afterDeserialize:o=>o},e),{keys:e.keys==="*"?[X]:e.keys})}function We(e){return e.storage===O.LocalStorage?localStorage:e.storage===O.SessionStorage?sessionStorage:null}function Ge(e,o){return o?.namespace?`${o.namespace}:${e}`:e}var Be=(()=>{class e{_keys=new Set;_injector=c(se);_keysWithEngines=[];constructor(){let{keys:t}=c(x);this.addKeys(t)}getKeysWithEngines(){return[...this._keysWithEngines]}addKeys(t){for(let n of t){let d=Re(n);if(this._keys.has(d))continue;this._keys.add(d);let f=J(n)?this._injector.get(n.engine):this._injector.get(Y);this._keysWithEngines.push({key:d,engine:f})}}static \u0275fac=function(n){return new(n||e)};static \u0275prov=_({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),He=(()=>{class e{_keysManager=c(Be);_options=c(x);_allStatesPersisted=c(Le);handle(t,n,d){let f=Pe(n),$e=f===Ce.type,Z=f===Ie.type,q=$e||Z,ee=!1;if(q){let g=Z&&n.addedStates;for(let{key:p,engine:S}of this._keysManager.getKeysWithEngines()){if(!this._allStatesPersisted&&g){let s=p.indexOf(Xe),K=s>-1?p.slice(0,s):p;if(!M(g,K))continue}if(!S)continue;let C=Ge(p,this._options),a=S.getItem(C);if(a!=="undefined"&&a!=null){try{let s=this._options.deserialize(a);a=this._options.afterDeserialize(s,p)}catch{a={}}this._options.migrations?.forEach(s=>{let K=s.version===B(a,s.versionKey||"version"),ze=!s.key&&this._allStatesPersisted||s.key===p;K&&ze&&(a=s.migrate(a),ee=!0)}),this._allStatesPersisted?(a=this._hydrateSelectivelyOnUpdate(a,g),t=I(I({},t),a)):t=ke(t,p,a)}}}return d(t,n).pipe(P(g=>{if(!(q&&!ee))for(let{key:p,engine:S}of this._keysManager.getKeysWithEngines()){if(!S)continue;let C=g,a=Ge(p,this._options);p!==X&&(C=B(g,p));try{let s=this._options.beforeSerialize(C,p);S.setItem(a,this._options.serialize(s))}catch{}}}))}_hydrateSelectivelyOnUpdate(t,n){return!t||!n||Object.keys(n).length===0?t:Object.keys(n).reduce((d,f)=>(M(t,f)&&(d[f]=t[f]),d),{})}static \u0275fac=function(n){return new(n||e)};static \u0275prov=_({token:e,factory:e.\u0275fac})}return e})(),Xe=".",Fe=(()=>{class e{static forRoot(t){return{ngModule:e,providers:[Ae(He),{provide:G,useValue:t},{provide:x,useFactory:Ve,deps:[G]},{provide:Y,useFactory:We,deps:[x]}]}}static \u0275fac=function(n){return new(n||e)};static \u0275mod=ce({type:e});static \u0275inj=oe({})}return e})();var i=class{constructor(o){this.authService=o}static token(o){return o.token}static profile(o){return o.profile}static isAuthenticated(o){return o.isAuthenticated}login(o,t){return this.authService.login(t.payload).pipe(P(n=>{o.dispatch(new H(n.token,n.user))}))}setAuthData(o,t){o.patchState({token:t.token,profile:t.profile,isAuthenticated:!0})}logout(o){o.setState({token:null,profile:null,isAuthenticated:!1}),localStorage.removeItem("auth")}};U(i,"\u0275fac",function(t){return new(t||i)(ne(De))}),U(i,"\u0275prov",_({token:i,factory:i.\u0275fac})),u([w(Ne)],i.prototype,"login",1),u([w(H)],i.prototype,"setAuthData",1),u([w(R)],i.prototype,"logout",1),u([L()],i,"token",1),u([L()],i,"profile",1),u([L()],i,"isAuthenticated",1),i=u([be({name:"auth",defaults:{token:null,profile:null,isAuthenticated:!1}})],i);function Je(e,o){e&1&&($(0),l(1,"a",2),r(2,"Liste des pollutions \u{1F6AE}"),m(),r(3," | "),l(4,"a",3),r(5,"Se connecter"),m(),r(6," | "),l(7,"a",4),r(8,"S'inscrire"),m(),z())}function Qe(e,o){if(e&1&&(l(0,"span"),r(1," Bienvenue "),l(2,"b"),r(3),m()()),e&2){let t=o.ngIf;y(3),de(t.email)}}function Ze(e,o){if(e&1){let t=le();$(0),T(1,Qe,4,1,"span",1),A(2,"async"),r(3," | "),l(4,"a",2),r(5,"Liste des pollutions \u{1F6AE}"),m(),r(6," | "),l(7,"a",5),r(8,"D\xE9clarer une pollution \u2795"),m(),r(9," | "),l(10,"a",6),r(11,"Favoris \u2B50"),m(),r(12," | "),l(13,"a",7),r(14,"Dashboard"),m(),r(15," | "),l(16,"button",8),me("click",function(){re(t);let d=V();return ae(d.logout())}),r(17,"Se d\xE9connecter"),m(),z()}if(e&2){let t=V();y(),b("ngIf",N(2,1,t.profile$))}}var F=class e{constructor(o,t){this.store=o;this.router=t;this.isAuth$=this.store.select(i.isAuthenticated),this.profile$=this.store.select(i.profile)}isAuth$;profile$;logout(){this.store.dispatch(new R),this.router.navigate(["/login"])}static \u0275fac=function(t){return new(t||e)(E(h),E(D))};static \u0275cmp=k({type:e,selectors:[["app-navbar"]],decls:5,vars:6,consts:[[2,"padding","15px","background","#eee","margin-bottom","20px"],[4,"ngIf"],["routerLink","/pollutions","routerLinkActive","active"],["routerLink","/login"],["routerLink","/register"],["routerLink","/pollutions/new","routerLinkActive","active",1,"btn-primary"],["routerLink","/favorites"],["routerLink","/dashboard"],[3,"click"]],template:function(t,n){t&1&&(l(0,"nav",0),T(1,Je,9,0,"ng-container",1),A(2,"async"),T(3,Ze,18,3,"ng-container",1),A(4,"async"),m()),t&2&&(y(),b("ngIf",!N(2,2,n.isAuth$)),y(2),b("ngIf",N(4,4,n.isAuth$)))},dependencies:[ge,fe,Oe,ye,Ee,ue],encapsulation:2})};var j=class e{constructor(o){this.favoriteService=o}title="Pollution Tracker";favorites$;ngOnInit(){this.favorites$=this.favoriteService.favorites$}static \u0275fac=function(t){return new(t||e)(E(we))};static \u0275cmp=k({type:e,selectors:[["app-root"]],decls:2,vars:0,template:function(t,n){t&1&&pe(0,"app-navbar")(1,"router-outlet")},dependencies:[_e,F],styles:[".app-container[_ngcontent-%COMP%]{min-height:100vh;display:flex;flex-direction:column;background:#f5f5f5}.app-header[_ngcontent-%COMP%]{background:#fff;box-shadow:0 2px 4px #0000001a;position:sticky;top:0;z-index:1000}.header-content[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:1rem;display:flex;justify-content:space-between;align-items:center;gap:2rem}.logo[_ngcontent-%COMP%]{margin:0;font-size:1.5rem}.logo[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:#333;transition:color .3s}.logo[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#4caf50}.nav-menu[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center}.nav-menu[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:#555;font-weight:600;padding:.75rem 1.25rem;border-radius:4px;transition:all .3s}.nav-menu[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#333;background:#f0f0f0}.nav-menu[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]{color:#4caf50}.btn-primary[_ngcontent-%COMP%]{background:#4caf50!important;color:#fff!important}.btn-primary[_ngcontent-%COMP%]:hover{background:#45a049!important;color:#fff!important}.app-main[_ngcontent-%COMP%]{flex:1;padding:2rem 0}.app-footer[_ngcontent-%COMP%]{background:#333;color:#fff;text-align:center;padding:1.5rem;margin-top:3rem}.app-footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}@media(max-width:768px){.header-content[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.nav-menu[_ngcontent-%COMP%]{flex-direction:column;width:100%}.nav-menu[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{width:100%;text-align:center}}"]})};var je=()=>{let e=c(h),o=c(D);return e.selectSnapshot(i.isAuthenticated)?!0:(o.navigate(["/login"]),!1)};var Ke=[{path:"dashboard",canActivate:[je],loadComponent:()=>import("./chunk-JMMN6A7Q.js").then(e=>e.DashboardComponent)},{path:"login",loadComponent:()=>import("./chunk-GIJBXVFT.js").then(e=>e.LoginComponent)},{path:"register",loadComponent:()=>import("./chunk-ZTSJZUJC.js").then(e=>e.RegisterComponent)},{path:"pollutions",loadComponent:()=>import("./chunk-RX6BRBV5.js").then(e=>e.PollutionListComponent)},{path:"pollutions/new",loadComponent:()=>import("./chunk-XQLME5TA.js").then(e=>e.PollutionFormComponent)},{path:"pollutions/:id",loadComponent:()=>import("./chunk-EKGBY5KT.js").then(e=>e.PollutionDetailComponent)},{path:"favorites",loadComponent:()=>import("./chunk-2KOD25XQ.js").then(e=>e.FavoritesListComponent)},{path:"",redirectTo:"/pollutions",pathMatch:"full"},{path:"**",redirectTo:"/pollutions"}];var Ue=(e,o)=>{let n=c(h).selectSnapshot(i.token);return n&&(e=e.clone({setHeaders:{Authorization:`Bearer ${n}`}})),o(e)};ve(j,{providers:[Me(Ke),he(Se([Ue])),ie(Te.forRoot([i]),Fe.forRoot({keys:["auth"]}))]});
